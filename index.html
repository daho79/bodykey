<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BodyKey - Weight Management</title>
    <meta name="description" content="BodyKey - Your comprehensive weight management companion. Track progress, set goals, and stay motivated.">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéØ</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .logo {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-size: 28px;
            font-weight: bold;
            color: #667eea;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        nav {
            margin-top: 20px;
        }

        nav button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 0 5px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        nav button:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        nav button.active {
            background: #764ba2;
        }

        .content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .welcome-section {
            text-align: center;
            margin-bottom: 40px;
        }

        .welcome-section h1 {
            font-size: 3em;
            color: #667eea;
            margin-bottom: 20px;
        }

        .welcome-section p {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 30px;
        }

        .cta-button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            border-radius: 25px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .cta-button:hover {
            transform: scale(1.05);
        }

        .dashboard {
            display: none;
        }

        .dashboard.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .stat-card p {
            opacity: 0.9;
        }

        .tracking-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #667eea;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s ease;
        }

        .btn:hover {
            background: #5a6fd8;
        }

        .progress-chart {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }

        .chart-placeholder {
            width: 100%;
            height: 200px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            margin-top: 20px;
        }

        .goals-section, .motivation-section, .profile-section {
            display: none;
        }

        .goals-section.active, .motivation-section.active, .profile-section.active {
            display: block;
        }

        .goal-card {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .motivation-section {
            text-align: center;
        }

        .quote-card {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .quote-card h3 {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #d4691a;
        }

        .tips-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .tip-card {
            background: linear-gradient(135deg, #e0c3fc 0%, #9bb5ff 100%);
            padding: 20px;
            border-radius: 15px;
        }

        .profile-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
        }

        .profile-avatar {
            text-align: center;
        }

        .avatar-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: white;
        }

        .github-info {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .github-info h3 {
            margin-bottom: 10px;
        }

        .github-link {
            color: white;
            text-decoration: none;
            font-weight: bold;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            display: inline-block;
            margin-top: 10px;
            transition: background 0.3s ease;
        }

        .github-link:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        @media (max-width: 768px) {
            .tracking-section {
                grid-template-columns: 1fr;
            }
            
            .profile-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            nav button {
                display: block;
                width: 100%;
                margin: 5px 0;
            }

            .welcome-section h1 {
                font-size: 2em;
            }
            
            .profile-photo {
                width: 120px;
                height: 120px;
                font-size: 36px;
            }
            
            .photo-upload-overlay {
                width: 35px;
                height: 35px;
            }
            
            .photo-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .photo-btn {
                width: 100%;
                max-width: 200px;
            }
        }

        .status-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
            font-weight: 600;
        }
        
        .recent-logs {
            margin-top: 30px;
            background: #f8f9ff;
            border-radius: 15px;
            padding: 20px;
        }
        
        .logs-container {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .logs-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .logs-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            border: none;
        }
        
        .logs-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
            vertical-align: middle;
        }
        
        .logs-table tr:hover {
            background: #f8f9ff;
        }
        
        .logs-table tr:last-child td {
            border-bottom: none;
        }
        
        .log-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 60px;
            gap: 15px;
            align-items: center;
        }
        
        .log-item .log-date {
            font-weight: 600;
            color: #667eea;
        }
        
        .log-item .log-weight {
            font-size: 1.1em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .log-item .log-details {
            font-size: 0.9em;
            color: #666;
        }
        
        .weight-cell {
            font-weight: bold;
            color: #667eea;
            font-size: 1.1em;
        }
        
        .details-cell {
            color: #666;
            font-size: 0.9em;
        }
        
        .actions-cell {
            text-align: center;
        }
        
        .delete-log {
            background: #ff4757;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
        }
        
        .data-management {
            margin-top: 30px;
            background: #fff3e0;
            border-radius: 15px;
            padding: 20px;
        }
        
        .management-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .btn-danger {
            background: #ff4757 !important;
        }
        
        .btn-danger:hover {
            background: #ff3742 !important;
        }
        
        .data-stats {
            background: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 10px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #666;
        }
        
        .saved-goals {
            margin-top: 20px;
            background: #f0f8ff;
            border-radius: 15px;
            padding: 20px;
        }
        
        .goals-list {
            margin-top: 15px;
        }
        
        .goal-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .goal-text {
            flex: 1;
            font-weight: 500;
        }
        
        .goal-category {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin: 0 10px;
        }
        
        .goal-date {
            font-size: 0.9em;
            color: #666;
            margin: 0 10px;
        }
        
        .goal-actions {
            display: flex;
            gap: 5px;
        }
        
        .goal-complete {
            background: #2ed573;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
        }
        
        .goal-delete {
            background: #ff4757;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
        }
        
        .goal-category-select,
        .goal-date {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            margin-top: 8px;
        }
        
        .import-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .import-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
        }
        
        .import-textarea {
            width: 100%;
            height: 200px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: monospace;
            resize: vertical;
        }
        
        .goal-item.completed {
            opacity: 0.7;
            background: #f0f8f0;
        }
        
        .save-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2ed573;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .save-indicator.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .auto-save {
            font-size: 0.9em;
            color: #2ed573;
            margin-left: 10px;
        }
        
        .data-sync-status {
            background: #e8f5e8;
            color: #2d5016;
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .unsaved-changes {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .profile-photo-section {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .profile-photo-container {
            position: relative;
            display: inline-block;
            margin-bottom: 20px;
        }
        
        .profile-photo {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #667eea;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: white;
            cursor: pointer;
            transition: transform 0.3s ease;
            overflow: hidden;
        }
        
        .profile-photo:hover {
            transform: scale(1.05);
        }
        
        .profile-photo img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .photo-upload-overlay {
            position: absolute;
            bottom: 0;
            right: 0;
            background: #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 3px solid white;
            transition: background 0.3s ease;
        }
        
        .photo-upload-overlay:hover {
            background: #5a6fd8;
        }
        
        .photo-upload-overlay::before {
            content: 'üì∑';
            font-size: 18px;
        }
        
        .photo-upload-input {
            display: none;
        }
        
        .photo-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .photo-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .photo-btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        
        .photo-btn.danger {
            background: #ff4757;
        }
        
        .photo-btn.danger:hover {
            background: #ff3742;
        }
        
        .photo-preview {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            display: none;
        }
        
        .photo-preview img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .photo-info {
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Save Indicator -->
    <div id="save-indicator" class="save-indicator">
        <span id="save-text">üíæ Data Saved!</span>
    </div>
    
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">BK</div>
                BodyKey Weight Management
            </div>
            <nav>
                <button class="nav-btn active" data-section="home">üè† Home</button>
                <button class="nav-btn" data-section="dashboard">üìä Dashboard</button>
                <button class="nav-btn" data-section="goals">üéØ Goals</button>
                <button class="nav-btn" data-section="motivation">üí™ Motivation</button>
                <button class="nav-btn" data-section="profile">üë§ Profile</button>
            </nav>
        </header>

        <div class="content">
            <!-- Home Section -->
            <div id="home" class="section active">
                <div class="github-info">
                    <h3>üöÄ Now Hosted on GitHub Pages!</h3>
                    <p>Your BodyKey website is successfully deployed and accessible worldwide</p>
                    <a href="https://github.com" class="github-link" target="_blank">View on GitHub</a>
                </div>
                
                <div class="welcome-section">
                    <h1>üéØ Welcome to BodyKey</h1>
                    <p>Your comprehensive weight management companion. Track your progress, set goals, and stay motivated on your health journey.</p>
                    <button class="cta-button" onclick="showSection('dashboard')">Start Tracking Today</button>
                </div>
                
                <div class="status-message">
                    ‚úÖ Website is fully functional and hosted on GitHub Pages!
                </div>
            </div>

            <!-- Dashboard Section -->
            <div id="dashboard" class="section dashboard">
                <h2>üìä Your Dashboard</h2>
                
                <!-- Data Sync Status -->
                <div id="sync-status" class="data-sync-status">
                    <span>üíæ</span>
                    <span id="sync-message">All data saved automatically</span>
                    <span id="last-save" class="auto-save"></span>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 id="current-weight">75.0</h3>
                        <p>Current Weight (kg)</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="goal-weight">--</h3>
                        <p>Goal Weight (kg)</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="progress">-2.4</h3>
                        <p>Progress (kg)</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="bmi">24.8</h3>
                        <p>BMI</p>
                    </div>
                </div>

                <div class="tracking-section">
                    <div>
                        <h3>üìù Log Today's Data</h3>
                        <div class="input-group">
                            <label for="weight-input">Weight (kg)</label>
                            <input type="number" id="weight-input" placeholder="Enter your weight in kg" step="0.1">
                        </div>
                        <div class="input-group">
                            <label for="calories-input">Calories</label>
                            <input type="number" id="calories-input" placeholder="Daily calories">
                        </div>
                        <div class="input-group">
                            <label for="exercise-input">Exercise (minutes)</label>
                            <input type="number" id="exercise-input" placeholder="Exercise duration">
                        </div>
                        <button class="btn" onclick="logData()">Log Data</button>
                        <div id="log-message"></div>
                        
                        <!-- Goal Weight Setting Section -->
                        <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
                            <h4>üéØ Set Goal Weight</h4>
                            <div class="input-group">
                                <label for="goal-weight-input">Target Weight (kg)</label>
                                <input type="number" id="goal-weight-input" placeholder="Enter your goal weight" step="0.1">
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn" onclick="setGoalWeight()">Set Goal</button>
                                <button class="btn btn-danger" onclick="clearGoalWeight()">Clear Goal</button>
                            </div>
                            <div id="goal-message"></div>
                        </div>
                    </div>

                    <div class="progress-chart">
                        <h3>üìà Progress Chart</h3>
                        <div class="chart-placeholder">
                            <div>üìä Interactive Chart</div>
                            <small>(Chart.js integration ready)</small>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Logs Section -->
                <div class="recent-logs">
                    <h3>üìã Recent Weight Logs</h3>
                    <div id="logs-display" class="logs-container">
                        <!-- Dynamic content will be loaded here -->
                    </div>
                </div>
                
                <!-- Data Management Section -->
                <div class="data-management">
                    <h3>üíæ Data Management</h3>
                    <div class="management-buttons">
                        <button class="btn" onclick="exportData()">üì§ Export Data</button>
                        <button class="btn" onclick="showImportDialog()">üì• Import Data</button>
                        <button class="btn" onclick="clearDemoData()" style="background: #f39c12;">üßΩ Clear Demo Data</button>
                        <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
                    </div>
                    <div id="data-stats" class="data-stats">
                        <!-- Database statistics will be shown here -->
                    </div>
                </div>
            </div>

            <!-- Goals Section -->
            <div id="goals" class="section goals-section">
                <h2>üéØ Your Goals</h2>
                
                <div class="goal-card">
                    <h3>Primary Weight Goal</h3>
                    <p><strong>Target:</strong> No goal set</p>
                    <p><strong>Timeline:</strong> Set your target weight below</p>
                    <p><strong>Progress:</strong> Ready to start</p>
                </div>

                <div class="goal-card">
                    <h3>Fitness Goals</h3>
                    <p><strong>Exercise:</strong> 30 minutes daily</p>
                    <p><strong>Steps:</strong> 10,000 steps per day</p>
                    <p><strong>Water:</strong> 8 glasses daily</p>
                </div>
                
                <!-- Saved Goals Display -->
                <div id="saved-goals" class="saved-goals">
                    <h3>üìã Your Saved Goals</h3>
                    <div id="goals-list" class="goals-list">
                        <!-- Dynamic goals will be loaded here -->
                    </div>
                </div>

                <div class="input-group">
                    <label for="new-goal">Set New Goal</label>
                    <input type="text" id="new-goal" placeholder="Enter your new goal">
                    <select id="goal-category" class="goal-category">
                        <option value="weight">Weight Loss</option>
                        <option value="fitness">Fitness</option>
                        <option value="nutrition">Nutrition</option>
                        <option value="general">General Health</option>
                    </select>
                    <input type="date" id="goal-date" class="goal-date">
                    <button class="btn" onclick="addGoal()">Add Goal</button>
                </div>
            </div>

            <!-- Motivation Section -->
            <div id="motivation" class="section motivation-section">
                <h2>üí™ Daily Motivation</h2>
                
                <div class="quote-card">
                    <h3>"Success is the sum of small efforts repeated day in and day out."</h3>
                    <p>- Robert Collier</p>
                </div>

                <div class="tips-grid">
                    <div class="tip-card">
                        <h4>üíß Stay Hydrated</h4>
                        <p>Drink water before meals to help control appetite and boost metabolism.</p>
                    </div>
                    <div class="tip-card">
                        <h4>ü•ó Meal Prep</h4>
                        <p>Prepare healthy meals in advance to avoid impulsive food choices.</p>
                    </div>
                    <div class="tip-card">
                        <h4>üò¥ Quality Sleep</h4>
                        <p>Aim for 7-9 hours of sleep to support weight management and recovery.</p>
                    </div>
                    <div class="tip-card">
                        <h4>üì± Track Progress</h4>
                        <p>Regular monitoring helps maintain motivation and accountability.</p>
                    </div>
                </div>
            </div>

            <!-- Profile Section -->
            <div id="profile" class="section profile-section">
                <h2>üë§ Your Profile</h2>
                
                <!-- Profile Photo Section -->
                <div class="profile-photo-section">
                    <h3>üì∑ Profile Photo</h3>
                    <div class="profile-photo-container">
                        <div class="profile-photo" id="profile-photo" onclick="triggerPhotoUpload()">
                            <span id="photo-placeholder">üë§</span>
                        </div>
                        <div class="photo-upload-overlay" onclick="triggerPhotoUpload()"></div>
                        <input type="file" id="photo-upload-input" class="photo-upload-input" accept="image/*" onchange="handlePhotoUpload(event)">
                    </div>
                    
                    <div class="photo-actions">
                        <button class="photo-btn" onclick="triggerPhotoUpload()">
                            üìÅ Choose Photo
                        </button>
                        <button class="photo-btn" onclick="takePhoto()">
                            üì∏ Take Photo
                        </button>
                        <button class="photo-btn danger" onclick="removePhoto()">
                            üóëÔ∏è Remove Photo
                        </button>
                    </div>
                    
                    <div id="photo-preview" class="photo-preview">
                        <div class="photo-info">
                            <p><strong>Preview:</strong></p>
                            <img id="preview-image" src="" alt="Preview">
                            <div id="file-info"></div>
                        </div>
                    </div>
                </div>
                
                <div class="profile-grid">
                    <div class="profile-avatar">
                        <div class="avatar-circle" id="main-avatar">
                            <span id="avatar-text">üë§</span>
                        </div>
                        <h3 id="profile-display-name">John Doe</h3>
                        <p>Member since: January 2024</p>
                        <div class="data-sync-status">
                            <span>üíæ</span>
                            <span>Profile auto-saves</span>
                        </div>
                    </div>
                    
                    <div>
                        <div class="input-group">
                            <label for="name">Full Name</label>
                            <input type="text" id="name" value="John Doe">
                        </div>
                        <div class="input-group">
                            <label for="email">Email</label>
                            <input type="email" id="email" value="john@example.com">
                        </div>
                        <div class="input-group">
                            <label for="height">Height (cm)</label>
                            <input type="number" id="height" value="178">
                        </div>
                        <div class="input-group">
                            <label for="age">Age</label>
                            <input type="number" id="age" value="30">
                        </div>
                        <button class="btn" onclick="updateProfile()">Update Profile</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // SAVE NOTIFICATION SYSTEM
        // ========================================
        
        function showSaveIndicator(message = 'üíæ Data Saved!', type = 'success') {
            const indicator = document.getElementById('save-indicator');
            const text = document.getElementById('save-text');
            
            text.textContent = message;
            indicator.style.background = type === 'success' ? '#2ed573' : '#ff4757';
            indicator.classList.add('show');
            
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
            
            // Update sync status
            updateSyncStatus(message);
        }
        
        function updateSyncStatus(action = 'Data synchronized') {
            const syncMessage = document.getElementById('sync-message');
            const lastSave = document.getElementById('last-save');
            
            if (syncMessage) {
                syncMessage.textContent = action;
                lastSave.textContent = `Last saved: ${new Date().toLocaleTimeString()}`;
            }
        }
        
        function showUnsavedChanges() {
            const syncStatus = document.getElementById('sync-status');
            if (syncStatus) {
                syncStatus.className = 'data-sync-status unsaved-changes';
                document.getElementById('sync-message').textContent = 'Unsaved changes detected';
            }
        }
        
        function showSavedStatus() {
            const syncStatus = document.getElementById('sync-status');
            if (syncStatus) {
                syncStatus.className = 'data-sync-status';
                document.getElementById('sync-message').textContent = 'All data saved automatically';
            }
        }
        
        // ========================================
        // ENHANCED DATABASE SYSTEM
        // ========================================
        
        class BodyKeyDatabase {
            constructor() {
                this.dbName = 'bodykey-database';
                this.initializeDatabase();
            }
            
            // Initialize database structure
            initializeDatabase() {
                if (!localStorage.getItem(this.dbName)) {
                    const initialDB = {
                        profile: {
                            name: "Demo User",
                            height: 178,
                            age: 30
                        },
                        weightLogs: [
                            {
                                id: Date.now() - 604800000, // 7 days ago
                                date: new Date(Date.now() - 604800000).toISOString().split('T')[0],
                                timestamp: new Date(Date.now() - 604800000).toISOString(),
                                weight: 77.4,
                                calories: 2000,
                                exercise: 30
                            },
                            {
                                id: Date.now() - 518400000, // 6 days ago
                                date: new Date(Date.now() - 518400000).toISOString().split('T')[0],
                                timestamp: new Date(Date.now() - 518400000).toISOString(),
                                weight: 76.8,
                                calories: 1950,
                                exercise: 45
                            },
                            {
                                id: Date.now() - 432000000, // 5 days ago
                                date: new Date(Date.now() - 432000000).toISOString().split('T')[0],
                                timestamp: new Date(Date.now() - 432000000).toISOString(),
                                weight: 76.2,
                                calories: null,
                                exercise: 20
                            },
                            {
                                id: Date.now() - 345600000, // 4 days ago
                                date: new Date(Date.now() - 345600000).toISOString().split('T')[0],
                                timestamp: new Date(Date.now() - 345600000).toISOString(),
                                weight: 75.9,
                                calories: 2100,
                                exercise: null
                            },
                            {
                                id: Date.now() - 259200000, // 3 days ago
                                date: new Date(Date.now() - 259200000).toISOString().split('T')[0],
                                timestamp: new Date(Date.now() - 259200000).toISOString(),
                                weight: 75.5,
                                calories: 1900,
                                exercise: 40
                            }
                        ],
                        goals: [
                            {
                                id: Date.now() - 86400000,
                                text: "Lose 5 kg in 3 months",
                                targetDate: new Date(Date.now() + 7776000000).toISOString().split('T')[0], // 3 months from now
                                category: "weight",
                                completed: false,
                                createdDate: new Date(Date.now() - 86400000).toISOString().split('T')[0],
                                progress: 30
                            },
                            {
                                id: Date.now() - 172800000,
                                text: "Exercise 30 minutes daily",
                                targetDate: null,
                                category: "fitness",
                                completed: false,
                                createdDate: new Date(Date.now() - 172800000).toISOString().split('T')[0],
                                progress: 0
                            }
                        ],
                        motivationData: {
                            dailyQuotes: [],
                            completedTips: [],
                            streakCount: 5
                        },
                        settings: {
                            theme: 'default',
                            units: 'metric',
                            notifications: true
                        },
                        statistics: {
                            totalLogins: 1,
                            lastLogin: new Date().toISOString(),
                            joinDate: new Date(Date.now() - 604800000).toISOString() // Started a week ago
                        }
                    };
                    this.saveDatabase(initialDB);
                    console.log('üéØ Demo data initialized with sample weight logs and goals!');
                } else {
                    console.log('üìä Existing data found, loading user data...');
                }
                this.updateLoginStats();
            }
            
            // Get entire database
            getDatabase() {
                return JSON.parse(localStorage.getItem(this.dbName) || '{}');
            }
            
            // Save entire database
            saveDatabase(data) {
                localStorage.setItem(this.dbName, JSON.stringify(data));
            }
            
            // Update login statistics
            updateLoginStats() {
                const db = this.getDatabase();
                db.statistics.totalLogins += 1;
                db.statistics.lastLogin = new Date().toISOString();
                this.saveDatabase(db);
            }
            
            // PROFILE OPERATIONS
            saveProfile(profileData) {
                const db = this.getDatabase();
                db.profile = { ...db.profile, ...profileData, lastUpdated: new Date().toISOString() };
                this.saveDatabase(db);
                return true;
            }
            
            getProfile() {
                return this.getDatabase().profile;
            }
            
            // WEIGHT LOG OPERATIONS
            addWeightLog(weightData) {
                const db = this.getDatabase();
                const logEntry = {
                    id: Date.now(),
                    date: new Date().toISOString().split('T')[0],
                    timestamp: new Date().toISOString(),
                    ...weightData
                };
                db.weightLogs.push(logEntry);
                // Keep only last 365 entries for performance
                if (db.weightLogs.length > 365) {
                    db.weightLogs = db.weightLogs.slice(-365);
                }
                this.saveDatabase(db);
                return logEntry;
            }
            
            getWeightLogs() {
                return this.getDatabase().weightLogs;
            }
            
            getLatestWeight() {
                const logs = this.getWeightLogs();
                return logs.length > 0 ? logs[logs.length - 1] : null;
            }
            
            deleteWeightLog(id) {
                const db = this.getDatabase();
                db.weightLogs = db.weightLogs.filter(log => log.id !== id);
                this.saveDatabase(db);
            }
            
            // GOALS OPERATIONS
            addGoal(goalData) {
                const db = this.getDatabase();
                const goal = {
                    id: Date.now(),
                    text: goalData.text,
                    targetDate: goalData.targetDate || null,
                    category: goalData.category || 'general',
                    completed: false,
                    createdDate: new Date().toISOString().split('T')[0],
                    progress: 0
                };
                db.goals.push(goal);
                this.saveDatabase(db);
                return goal;
            }
            
            getGoals() {
                return this.getDatabase().goals;
            }
            
            updateGoal(id, updates) {
                const db = this.getDatabase();
                const goalIndex = db.goals.findIndex(goal => goal.id === id);
                if (goalIndex !== -1) {
                    db.goals[goalIndex] = { ...db.goals[goalIndex], ...updates };
                    this.saveDatabase(db);
                    return db.goals[goalIndex];
                }
                return null;
            }
            
            deleteGoal(id) {
                const db = this.getDatabase();
                db.goals = db.goals.filter(goal => goal.id !== id);
                this.saveDatabase(db);
            }
            
            // Clear goal weight from profile
            clearGoalWeight() {
                const profile = this.getProfile();
                delete profile.goalWeight;
                this.saveProfile(profile);
            }
            
            // Set goal weight
            setGoalWeight(weight) {
                const profile = this.getProfile();
                profile.goalWeight = parseFloat(weight);
                this.saveProfile(profile);
            }
            
            // Get goal weight
            getGoalWeight() {
                const profile = this.getProfile();
                return profile.goalWeight || null;
            }
            
            // MOTIVATION DATA OPERATIONS
            saveMotivationData(data) {
                const db = this.getDatabase();
                db.motivationData = { ...db.motivationData, ...data };
                this.saveDatabase(db);
            }
            
            getMotivationData() {
                return this.getDatabase().motivationData;
            }
            
            // SETTINGS OPERATIONS
            updateSettings(settings) {
                const db = this.getDatabase();
                db.settings = { ...db.settings, ...settings };
                this.saveDatabase(db);
            }
            
            getSettings() {
                return this.getDatabase().settings;
            }
            
            // STATISTICS
            getStatistics() {
                return this.getDatabase().statistics;
            }
            
            // DATA EXPORT/IMPORT
            exportData() {
                return this.getDatabase();
            }
            
            importData(data) {
                this.saveDatabase(data);
                this.loadAllData();
            }
            
            // CLEAR ALL DATA
            clearAllData() {
                localStorage.removeItem(this.dbName);
                this.initializeDatabase();
            }
        }
        
        // Initialize database
        const db = new BodyKeyDatabase();
        
        // ========================================
        // UI FUNCTIONS
        // ========================================
        
        // Navigation functionality
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(sectionName).classList.add('active');
            document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');
            
            // Load section-specific data
            loadSectionData(sectionName);
        }
        
        // Load data for specific sections
        function loadSectionData(sectionName) {
            switch(sectionName) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'goals':
                    loadGoalsData();
                    break;
                case 'motivation':
                    loadMotivationData();
                    break;
                case 'profile':
                    loadProfileData();
                    break;
            }
        }
        
        // Dashboard functionality
        function logData() {
            const weight = document.getElementById('weight-input').value;
            const calories = document.getElementById('calories-input').value;
            const exercise = document.getElementById('exercise-input').value;
            
            if (weight) {
                // Show saving indicator
                showUnsavedChanges();
                
                const logEntry = db.addWeightLog({
                    weight: parseFloat(weight),
                    calories: calories ? parseInt(calories) : null,
                    exercise: exercise ? parseInt(exercise) : null
                });
                
                updateDashboardDisplay();
                
                // Show success notifications
                showSaveIndicator(`üìä Weight logged: ${weight} kg`);
                showSavedStatus();
                
                document.getElementById('log-message').innerHTML = 
                    `<div class="status-message">‚úÖ Weight entry saved! ID: #${logEntry.id}</div>`;
                
                // Clear inputs
                document.getElementById('weight-input').value = '';
                document.getElementById('calories-input').value = '';
                document.getElementById('exercise-input').value = '';
                
                // Show recent logs
                displayRecentLogs();
                
                // Update data stats
                displayDataStats();
            } else {
                showSaveIndicator('‚ö†Ô∏è Please enter weight first', 'error');
                alert('Please enter your weight to log data.');
            }
        }
        
        function loadDashboardData() {
            updateDashboardDisplay();
            displayRecentLogs();
            displayDataStats();
        }
        
        function updateDashboardDisplay() {
            const latestLog = db.getLatestWeight();
            const profile = db.getProfile();
            const goalWeight = db.getGoalWeight();
            
            console.log('Dashboard update - Latest log:', latestLog);
            console.log('Dashboard update - Profile:', profile);
            console.log('Dashboard update - Goal weight:', goalWeight);
            
            // Always update the display, whether there's a log or not
            const currentWeightElement = document.getElementById('current-weight');
            const progressElement = document.getElementById('progress');
            const bmiElement = document.getElementById('bmi');
            const goalWeightElement = document.getElementById('goal-weight');
            
            // Update goal weight display
            if (goalWeight) {
                goalWeightElement.textContent = goalWeight.toFixed(1);
            } else {
                goalWeightElement.textContent = '--';
            }
            
            if (latestLog) {
                // Update with actual logged data
                currentWeightElement.textContent = latestLog.weight.toFixed(1);
                
                // Calculate progress based on goal weight or starting weight
                let progress;
                if (goalWeight) {
                    progress = (latestLog.weight - goalWeight).toFixed(1);
                    progressElement.textContent = progress;
                } else {
                    const startingWeight = 77.4; // Starting weight in kg
                    progress = (startingWeight - latestLog.weight).toFixed(1);
                    progressElement.textContent = progress;
                }
                
                // BMI calculation with kg and cm (metric system)
                const heightCm = profile.height || 178; // Default height in cm
                const heightM = heightCm / 100; // Convert to meters
                const bmi = (latestLog.weight / (heightM * heightM)).toFixed(1);
                bmiElement.textContent = bmi;
                
                console.log('Dashboard updated with logged data:', {
                    weight: latestLog.weight,
                    progress: progress,
                    bmi: bmi,
                    height: heightCm,
                    goalWeight: goalWeight
                });
            } else {
                // Show default values when no data is logged yet
                currentWeightElement.textContent = '--';
                progressElement.textContent = '0.0';
                
                // Calculate BMI with default values if height is available
                const heightCm = profile.height || 178;
                const heightM = heightCm / 100;
                const defaultWeight = 75.0; // Default weight for BMI calculation
                const defaultBmi = (defaultWeight / (heightM * heightM)).toFixed(1);
                bmiElement.textContent = defaultBmi;
                
                console.log('Dashboard updated with default values:', {
                    weight: '--',
                    progress: '0.0',
                    bmi: defaultBmi,
                    height: heightCm,
                    goalWeight: goalWeight
                });
            }
        }
        
        // Goal weight management functions
        function setGoalWeight() {
            const goalInput = document.getElementById('goal-weight-input');
            const goalValue = parseFloat(goalInput.value);
            
            if (goalValue && goalValue > 0) {
                db.setGoalWeight(goalValue);
                updateDashboardDisplay();
                
                document.getElementById('goal-message').innerHTML = 
                    `<div class="status-message">‚úÖ Goal weight set to ${goalValue} kg!</div>`;
                showSaveIndicator(`üéØ Goal weight set: ${goalValue} kg`);
                
                goalInput.value = '';
            } else {
                showSaveIndicator('‚ö†Ô∏è Please enter a valid weight', 'error');
                alert('Please enter a valid goal weight.');
            }
        }
        
        function clearGoalWeight() {
            if (confirm('Clear your goal weight?')) {
                db.clearGoalWeight();
                updateDashboardDisplay();
                
                document.getElementById('goal-message').innerHTML = 
                    `<div class="status-message">üóëÔ∏è Goal weight cleared!</div>`;
                showSaveIndicator('üóëÔ∏è Goal weight cleared');
            }
        }
        
        function displayRecentLogs() {
            const logs = db.getWeightLogs().slice(-15).reverse(); // Show more logs
            const logsContainer = document.getElementById('logs-display');
            
            if (logs.length === 0) {
                logsContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <h4>üìù No weight logs yet</h4>
                        <p>Start tracking your weight to see your progress here!</p>
                        <button class="btn" onclick="document.getElementById('weight-input').focus()">üìä Log Your First Entry</button>
                    </div>
                `;
                return;
            }
            
            // Create a proper table for the logs
            logsContainer.innerHTML = `
                <table class="logs-table">
                    <thead>
                        <tr>
                            <th>üìÖ Date</th>
                            <th>‚öñÔ∏è Weight</th>
                            <th>üìä Details</th>
                            <th>üîß Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${logs.map(log => {
                            const date = new Date(log.date);
                            const formattedDate = date.toLocaleDateString('en-US', {
                                month: 'short',
                                day: 'numeric',
                                year: 'numeric'
                            });
                            
                            const details = [];
                            if (log.calories) details.push(`üçΩÔ∏è ${log.calories} cal`);
                            if (log.exercise) details.push(`üí™ ${log.exercise} min`);
                            
                            return `
                                <tr>
                                    <td>
                                        <strong>${formattedDate}</strong><br>
                                        <small style="color: #888;">${date.toLocaleDateString('en-US', { weekday: 'short' })}</small>
                                    </td>
                                    <td class="weight-cell">
                                        <strong>${log.weight} kg</strong>
                                    </td>
                                    <td class="details-cell">
                                        ${details.length > 0 ? details.join('<br>') : '<span style="color: #ccc;">No additional data</span>'}
                                    </td>
                                    <td class="actions-cell">
                                        <button class="delete-log" onclick="deleteLog(${log.id})" title="Delete this entry">
                                            üóëÔ∏è
                                        </button>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
                
                <div style="margin-top: 15px; text-align: center; color: #666; font-size: 0.9em;">
                    üìà Showing last ${logs.length} entries ‚Ä¢ Total logged: ${db.getWeightLogs().length}
                </div>
            `;
        }
        
        function deleteLog(id) {
            if (confirm('Delete this log entry?')) {
                db.deleteWeightLog(id);
                displayRecentLogs();
                updateDashboardDisplay();
            }
        }
        
        function displayDataStats() {
            const stats = db.getStatistics();
            const logs = db.getWeightLogs();
            const goals = db.getGoals();
            const profile = db.getProfile();
            const latestLog = db.getLatestWeight();
            
            // Calculate additional stats
            const completedGoals = goals.filter(goal => goal.completed).length;
            const totalWeightChange = logs.length > 1 ? (logs[logs.length - 1].weight - logs[0].weight).toFixed(1) : 0;
            const daysTracking = logs.length > 0 ? Math.ceil((new Date() - new Date(logs[0].date)) / (1000 * 60 * 60 * 24)) : 0;
            
            const statsContainer = document.getElementById('data-stats');
            statsContainer.innerHTML = `
                <div class="stat-item">
                    <div class="stat-number">${logs.length}</div>
                    <div class="stat-label">üìà Weight Logs</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${goals.length}</div>
                    <div class="stat-label">üéØ Total Goals</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${completedGoals}</div>
                    <div class="stat-label">‚úÖ Completed Goals</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${daysTracking}</div>
                    <div class="stat-label">üìÖ Days Tracking</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${totalWeightChange > 0 ? '+' : ''}${totalWeightChange}</div>
                    <div class="stat-label">‚öñÔ∏è Total Change (kg)</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${latestLog ? latestLog.weight + ' kg' : '--'}</div>
                    <div class="stat-label">üìä Latest Weight</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${stats.totalLogins}</div>
                    <div class="stat-label">üîÑ Total Logins</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${new Date(stats.joinDate).toLocaleDateString()}</div>
                    <div class="stat-label">üéâ Member Since</div>
                </div>
            `;
        }
        
        // Goals functionality
        function addGoal() {
            const goalInput = document.getElementById('new-goal');
            const goalText = goalInput.value.trim();
            const goalCategory = document.getElementById('goal-category').value;
            const goalDate = document.getElementById('goal-date').value;
            
            if (goalText) {
                const goal = db.addGoal({ 
                    text: goalText,
                    category: goalCategory,
                    targetDate: goalDate || null
                });
                
                goalInput.value = '';
                document.getElementById('goal-date').value = '';
                loadGoalsData();
                
                showSaveIndicator(`üéØ Goal added: ${goalText.substring(0, 30)}${goalText.length > 30 ? '...' : ''}`);
                alert('Goal added successfully!');
            } else {
                showSaveIndicator('‚ö†Ô∏è Please enter a goal first', 'error');
                alert('Please enter a goal first.');
            }
        }
        
        function loadGoalsData() {
            const goals = db.getGoals();
            const goalsContainer = document.getElementById('goals-list');
            
            if (goals.length === 0) {
                goalsContainer.innerHTML = '<p style="text-align: center; color: #666;">No goals set yet. Add your first goal above!</p>';
                return;
            }
            
            goalsContainer.innerHTML = goals.map(goal => `
                <div class="goal-item ${goal.completed ? 'completed' : ''}">
                    <div class="goal-text ${goal.completed ? 'line-through' : ''}">${goal.text}</div>
                    <div class="goal-category">${goal.category}</div>
                    ${goal.targetDate ? `<div class="goal-date">üìÖ ${new Date(goal.targetDate).toLocaleDateString()}</div>` : ''}
                    <div class="goal-actions">
                        ${!goal.completed ? `<button class="goal-complete" onclick="completeGoal(${goal.id})">‚úì</button>` : ''}
                        <button class="goal-delete" onclick="deleteGoal(${goal.id})">‚ùå</button>
                    </div>
                </div>
            `).join('');
            
            console.log('Goals loaded:', goals.length);
        }
        
        function completeGoal(id) {
            db.updateGoal(id, { completed: true, completedDate: new Date().toISOString().split('T')[0] });
            loadGoalsData();
        }
        
        function deleteGoal(id) {
            if (confirm('Delete this goal?')) {
                db.deleteGoal(id);
                loadGoalsData();
            }
        }
        
        function loadMotivationData() {
            const motivationData = db.getMotivationData();
            // Update motivation display
            console.log('Motivation data loaded:', motivationData);
        }
        
        // Profile functionality
        function updateProfile() {
            const profileData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                height: document.getElementById('height').value,
                age: document.getElementById('age').value
            };
            
            db.saveProfile(profileData);
            showSaveIndicator(`üë§ Profile updated for ${profileData.name || 'User'}`);
            
            // Update display name
            updateProfileDisplay();
            
            // Update dashboard display (especially important for BMI when height changes)
            updateDashboardDisplay();
            
            alert('Profile updated successfully!');
        }
        
        function updateProfileDisplay() {
            const profile = db.getProfile();
            const displayName = document.getElementById('profile-display-name');
            const avatarText = document.getElementById('avatar-text');
            
            if (profile.name && displayName) {
                displayName.textContent = profile.name;
                // Update avatar with first letter of name
                if (!profile.photo && avatarText) {
                    avatarText.textContent = profile.name.charAt(0).toUpperCase();
                }
            }
        }
        
        // ========================================
        // PROFILE PHOTO FUNCTIONALITY
        // ========================================
        
        function triggerPhotoUpload() {
            document.getElementById('photo-upload-input').click();
        }
        
        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                // Validate file type
                if (!file.type.startsWith('image/')) {
                    showSaveIndicator('‚ö†Ô∏è Please select a valid image file', 'error');
                    return;
                }
                
                // Validate file size (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    showSaveIndicator('‚ö†Ô∏è Image size should be less than 5MB', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageData = e.target.result;
                    
                    // Save photo to profile
                    const profile = db.getProfile();
                    profile.photo = imageData;
                    profile.photoName = file.name;
                    profile.photoSize = file.size;
                    profile.photoType = file.type;
                    
                    db.saveProfile(profile);
                    
                    // Update UI
                    displayProfilePhoto(imageData);
                    showPhotoPreview(imageData, file);
                    showSaveIndicator('üì∑ Profile photo saved successfully!');
                    
                    // Update main avatar
                    updateMainAvatar(imageData);
                };
                reader.readAsDataURL(file);
            }
        }
        
        function displayProfilePhoto(imageData) {
            const photoContainer = document.getElementById('profile-photo');
            const placeholder = document.getElementById('photo-placeholder');
            
            if (imageData) {
                photoContainer.innerHTML = `<img src="${imageData}" alt="Profile Photo">`;
                placeholder.style.display = 'none';
            } else {
                photoContainer.innerHTML = '<span id="photo-placeholder">üë§</span>';
            }
        }
        
        function updateMainAvatar(imageData) {
            const mainAvatar = document.getElementById('main-avatar');
            const avatarText = document.getElementById('avatar-text');
            
            if (imageData) {
                mainAvatar.innerHTML = `<img src="${imageData}" alt="Avatar" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
            } else {
                const profile = db.getProfile();
                const initial = profile.name ? profile.name.charAt(0).toUpperCase() : 'üë§';
                mainAvatar.innerHTML = `<span id="avatar-text">${initial}</span>`;
            }
        }
        
        function showPhotoPreview(imageData, file) {
            const preview = document.getElementById('photo-preview');
            const previewImage = document.getElementById('preview-image');
            const fileInfo = document.getElementById('file-info');
            
            previewImage.src = imageData;
            fileInfo.innerHTML = `
                <p><strong>File:</strong> ${file.name}</p>
                <p><strong>Size:</strong> ${(file.size / 1024).toFixed(1)} KB</p>
                <p><strong>Type:</strong> ${file.type}</p>
            `;
            
            preview.style.display = 'block';
            
            // Auto-hide preview after 5 seconds
            setTimeout(() => {
                preview.style.display = 'none';
            }, 5000);
        }
        
        function takePhoto() {
            // Check if device supports camera
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(function(stream) {
                        // Create camera interface
                        createCameraInterface(stream);
                    })
                    .catch(function(err) {
                        showSaveIndicator('‚ö†Ô∏è Camera not available. Please choose a file instead.', 'error');
                        console.log('Camera error:', err);
                    });
            } else {
                showSaveIndicator('‚ö†Ô∏è Camera not supported. Please choose a file instead.', 'error');
            }
        }
        
        function createCameraInterface(stream) {
            // Create camera modal
            const modal = document.createElement('div');
            modal.className = 'import-dialog';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="import-content" style="max-width: 600px;">
                    <h3>üì∏ Take Profile Photo</h3>
                    <video id="camera-video" autoplay style="width: 100%; max-width: 400px; border-radius: 10px;"></video>
                    <canvas id="camera-canvas" style="display: none;"></canvas>
                    <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: center;">
                        <button class="btn" onclick="capturePhoto()">üì∑ Capture</button>
                        <button class="btn" onclick="closeCameraInterface()">‚ùå Cancel</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const video = document.getElementById('camera-video');
            video.srcObject = stream;
            
            // Store stream for cleanup
            window.currentCameraStream = stream;
        }
        
        function capturePhoto() {
            const video = document.getElementById('camera-video');
            const canvas = document.getElementById('camera-canvas');
            const context = canvas.getContext('2d');
            
            // Set canvas size to video size
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            // Draw video frame to canvas
            context.drawImage(video, 0, 0);
            
            // Convert to data URL
            const imageData = canvas.toDataURL('image/jpeg', 0.8);
            
            // Save photo
            const profile = db.getProfile();
            profile.photo = imageData;
            profile.photoName = `camera-${new Date().getTime()}.jpg`;
            profile.photoType = 'image/jpeg';
            
            db.saveProfile(profile);
            
            // Update UI
            displayProfilePhoto(imageData);
            updateMainAvatar(imageData);
            showSaveIndicator('üì∏ Photo captured and saved!');
            
            // Close camera
            closeCameraInterface();
        }
        
        function closeCameraInterface() {
            // Stop camera stream
            if (window.currentCameraStream) {
                window.currentCameraStream.getTracks().forEach(track => track.stop());
                window.currentCameraStream = null;
            }
            
            // Remove modal
            const modal = document.querySelector('.import-dialog');
            if (modal) {
                document.body.removeChild(modal);
            }
        }
        
        function removePhoto() {
            if (confirm('Remove profile photo?')) {
                const profile = db.getProfile();
                delete profile.photo;
                delete profile.photoName;
                delete profile.photoSize;
                delete profile.photoType;
                
                db.saveProfile(profile);
                
                // Update UI
                displayProfilePhoto(null);
                updateMainAvatar(null);
                document.getElementById('photo-preview').style.display = 'none';
                
                showSaveIndicator('üóëÔ∏è Profile photo removed');
            }
        }
        
        function loadProfileData() {
            const profile = db.getProfile();
            if (profile.name) {
                document.getElementById('name').value = profile.name || '';
                document.getElementById('email').value = profile.email || '';
                document.getElementById('height').value = profile.height || '';
                document.getElementById('age').value = profile.age || '';
                
                // Load profile photo
                if (profile.photo) {
                    displayProfilePhoto(profile.photo);
                    updateMainAvatar(profile.photo);
                }
                
                // Update profile display
                updateProfileDisplay();
            }
        }
        
        // Add click listeners to nav buttons
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const section = this.getAttribute('data-section');
                showSection(section);
            });
        });
        
        // Load all data on page load
        function loadAllData() {
            loadProfileData();
            loadDashboardData();
            loadGoalsData();
            loadMotivationData();
            // Ensure dashboard is updated after all data is loaded
            updateDashboardDisplay();
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            
            // Add auto-save listeners for profile fields
            const profileFields = ['name', 'email', 'height', 'age'];
            profileFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('blur', function() {
                        const profileData = {
                            name: document.getElementById('name').value,
                            email: document.getElementById('email').value,
                            height: document.getElementById('height').value,
                            age: document.getElementById('age').value
                        };
                        if (profileData[fieldId.replace('-', '')]) {
                            db.saveProfile(profileData);
                            showSaveIndicator(`üë§ ${fieldId} auto-saved`);
                            
                            // Update dashboard display if height changed (for BMI calculation)
                            if (fieldId === 'height') {
                                updateDashboardDisplay();
                            }
                            
                            // Update profile display if name changed
                            if (fieldId === 'name') {
                                updateProfileDisplay();
                            }
                        }
                    });
                }
            });
            
            // Add input validation feedback
            const weightInput = document.getElementById('weight-input');
            if (weightInput) {
                weightInput.addEventListener('input', function() {
                    const value = parseFloat(this.value);
                    if (value && (value < 20 || value > 450)) {
                        this.style.borderColor = '#ff4757';
                        showSaveIndicator('‚ö†Ô∏è Please check weight value (20-450 kg)', 'error');
                    } else {
                        this.style.borderColor = '#e0e0e0';
                    }
                });
            }
            
            const stats = db.getStatistics();
            console.log('üéØ BodyKey Database System Loaded Successfully!');
            console.log(`üìä Total logins: ${stats.totalLogins}`);
            console.log(`üë§ Profile data: ${Object.keys(db.getProfile()).length} fields`);
            console.log(`üìà Weight logs: ${db.getWeightLogs().length} entries`);
            console.log(`üéØ Goals: ${db.getGoals().length} active`);
            
            // Show welcome save status
            setTimeout(() => {
                updateSyncStatus('System ready - all data will auto-save');
            }, 1000);
        });
        
        // Data Management Functions
        function exportData() {
            const data = db.exportData();
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `bodykey-data-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('üì§ Data exported successfully!');
        }
        
        function showImportDialog() {
            const dialog = document.createElement('div');
            dialog.className = 'import-dialog';
            dialog.style.display = 'flex';
            dialog.innerHTML = `
                <div class="import-content">
                    <h3>üì• Import BodyKey Data</h3>
                    <p>Paste your exported JSON data below:</p>
                    <textarea id="import-data" class="import-textarea" placeholder="Paste your BodyKey data here..."></textarea>
                    <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                        <button class="btn" onclick="closeImportDialog()">‚ùå Cancel</button>
                        <button class="btn" onclick="importData()">‚úÖ Import</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(dialog);
        }
        
        function closeImportDialog() {
            const dialog = document.querySelector('.import-dialog');
            if (dialog) {
                document.body.removeChild(dialog);
            }
        }
        
        function importData() {
            const textarea = document.getElementById('import-data');
            try {
                const data = JSON.parse(textarea.value);
                db.importData(data);
                closeImportDialog();
                alert('üì• Data imported successfully!');
                // Refresh current section
                const activeSection = document.querySelector('.section.active').id;
                loadSectionData(activeSection);
            } catch (error) {
                alert('‚ùå Invalid JSON data. Please check your input.');
            }
        }
        
        function clearAllData() {
            if (confirm('‚ö†Ô∏è Are you sure you want to clear ALL data? This cannot be undone!')) {
                if (confirm('üóëÔ∏è This will delete all your weight logs, goals, and profile data. Continue?')) {
                    db.clearAllData();
                    alert('üóëÔ∏è All data cleared successfully!');
                    // Refresh all displays
                    loadAllData();
                }
            }
        }
        
        function clearDemoData() {
            if (confirm('üßΩ Clear demo data and start fresh? This will remove sample entries but keep your structure.')) {
                const freshDB = {
                    profile: {},
                    weightLogs: [],
                    goals: [],
                    motivationData: {
                        dailyQuotes: [],
                        completedTips: [],
                        streakCount: 0
                    },
                    settings: {
                        theme: 'default',
                        units: 'metric',
                        notifications: true
                    },
                    statistics: {
                        totalLogins: 1,
                        lastLogin: new Date().toISOString(),
                        joinDate: new Date().toISOString()
                    }
                };
                db.saveDatabase(freshDB);
                alert('‚ú® Demo data cleared! You can now start tracking your own data.');
                // Refresh all displays
                loadAllData();
            }
        }
    </script>
</body>
</html>